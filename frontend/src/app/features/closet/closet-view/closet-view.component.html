<div class="closet-container">
  <!-- Header -->
  <mat-card class="filters-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>inventory_2</mat-icon>
        My Closet
      </mat-card-title>
      <mat-card-subtitle>{{ getItemsCountText() }}</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Enhanced Filters -->
      <div class="filters-section">
        <!-- Search -->
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search your closet</mat-label>
          <input matInput 
                 placeholder="Search by name or tags..."
                 [(ngModel)]="searchTerm"
                 (input)="onSearchChange(searchTerm)">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <!-- Quick Filters Row -->
        <div class="quick-filters">
          <!-- Category Filter -->
          <div class="filter-group">
            <label>Category</label>
            <mat-select [(value)]="selectedCategory" 
                       (selectionChange)="onCategoryChange($event.value)"
                       class="category-select">
              <mat-option value="all">All Categories</mat-option>
              <mat-option *ngFor="let categoryInfo of categoryInfoList" [value]="categoryInfo.category">
                <mat-icon>{{ categoryInfo.icon }}</mat-icon>
                {{ categoryInfo.displayName }}
              </mat-option>
            </mat-select>
          </div>

          <!-- NEW: Color Filter -->
          <div class="filter-group color-filter-group">
            <label>Colors</label>
            <div class="color-filter-options">
              <button mat-icon-button
                      *ngFor="let color of availableColors"
                      [class]="'color-filter-btn color-' + color"
                      [class.selected]="isColorFilterSelected(color)"
                      (click)="toggleColorFilter(color)"
                      [title]="getColorDisplayName(color)">
                <mat-icon *ngIf="isColorFilterSelected(color)">check</mat-icon>
              </button>
              <button mat-icon-button 
                      *ngIf="selectedColors.length > 0"
                      (click)="clearColorFilters()"
                      class="clear-colors-btn"
                      title="Clear color filters">
                <mat-icon>clear</mat-icon>
              </button>
            </div>
          </div>

          <!-- Favorites Toggle -->
          <div class="filter-group">
            <mat-slide-toggle 
              [(ngModel)]="showOnlyFavorites"
              (change)="onToggleFavorites()"
              color="primary">
              <mat-icon>favorite</mat-icon>
              Favorites Only
            </mat-slide-toggle>
          </div>

          <!-- View Mode Toggle -->
          <div class="filter-group view-toggle">
            <div class="view-toggle-buttons">
              <button mat-icon-button 
                      [color]="viewMode === 'grid' ? 'primary' : ''"
                      (click)="toggleViewMode()"
                      title="Switch to grid view">
                <mat-icon>grid_view</mat-icon>
              </button>
              <button mat-icon-button 
                      [color]="viewMode === 'list' ? 'primary' : ''"
                      (click)="toggleViewMode()"
                      title="Switch to list view">
                <mat-icon>view_list</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <!-- Active Filters Display -->
        <div *ngIf="hasActiveFilters()" class="active-filters">
          <span class="filters-label">Active filters:</span>
          
          <mat-chip-listbox class="filter-chips">
            <mat-chip *ngIf="selectedCategory !== 'all'" 
                     (removed)="onCategoryChange('all')"
                     [removable]="true">
              {{ getCategoryDisplayName(selectedCategory) }}
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
            
            <mat-chip *ngFor="let color of selectedColors"
                     (removed)="toggleColorFilter(color)"
                     [removable]="true"
                     [style.background-color]="getColorHex(color)"
                     [style.color]="getTextColorForBackground(color)">
              {{ getColorDisplayName(color) }}
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
            
            <mat-chip *ngIf="showOnlyFavorites"
                     (removed)="onToggleFavorites()"
                     [removable]="true">
              <mat-icon>favorite</mat-icon>
              Favorites
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
          </mat-chip-listbox>
          
          <button mat-button (click)="clearAllFilters()" class="clear-all-btn">
            <mat-icon>clear_all</mat-icon>
            Clear All
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading your closet...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && clothingItems.length === 0" class="empty-state">
    <mat-icon class="empty-icon">checkroom</mat-icon>
    <h2>Your closet is empty</h2>
    <p>Start building your virtual closet by uploading photos of your clothes!</p>
    <button mat-raised-button color="primary" routerLink="/upload">
      <mat-icon>add</mat-icon>
      Add First Item
    </button>
  </div>

  <!-- No Results State -->
  <div *ngIf="!isLoading && clothingItems.length > 0 && filteredItems.length === 0" class="no-results-state">
    <mat-icon class="no-results-icon">search_off</mat-icon>
    <h3>No items match your filters</h3>
    <p>Try adjusting your search terms or category filter.</p>
              <button mat-button (click)="clearAllFilters()">
      <mat-icon>clear</mat-icon>
      Clear Filters
    </button>
  </div>

  <!-- Items Grid -->
  <div *ngIf="!isLoading && filteredItems.length > 0" class="items-container">
    <div [class]="'items-' + viewMode">
      <mat-card 
        *ngFor="let item of filteredItems; trackBy: trackByItemId" 
        class="item-card"
        [class.favorite]="item.isFavorite">
        
        <!-- Image Container -->
        <div class="image-container">
          <img [src]="item.thumbnailUrl" [alt]="item.originalFileName" class="item-image">
          
          <!-- Overlay Actions -->
          <div class="image-overlay">
            <button mat-icon-button class="favorite-btn" (click)="toggleFavorite(item)">
              <mat-icon [color]="item.isFavorite ? 'primary' : ''">
                {{ item.isFavorite ? 'favorite' : 'favorite_border' }}
              </mat-icon>
            </button>
            
            <button mat-icon-button class="delete-btn" (click)="deleteItem(item)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>

          <!-- Category Badge -->
          <div class="category-badge">
            {{ getCategoryDisplayName(item.category) }}
          </div>
        </div>

        <!-- Item Info -->
        <mat-card-content class="item-info">
          <h4 class="item-title">{{ item.originalFileName }}</h4>
          
          <div class="item-details">
            <div class="detail-row">
              <mat-icon class="detail-icon">palette</mat-icon>
              <span>{{ getColorDisplay(item.colors) }}</span>
            </div>
            
            <div class="detail-row" *ngIf="item.tags.length > 0">
              <mat-icon class="detail-icon">local_offer</mat-icon>
              <div class="tags-container">
                <mat-chip *ngFor="let tag of item.tags" class="tag-chip">{{ tag }}</mat-chip>
              </div>
            </div>
            
            <div class="detail-row">
              <mat-icon class="detail-icon">schedule</mat-icon>
              <span>{{ getFormattedDate(item.createdAt) }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
